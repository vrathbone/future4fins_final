---
title: "Artisanal Cost Layer"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(raster)
library(tidyverse)
library(sf)
library(here)
library(fasterize)
library(stringr)
library(janitor)
```

#### **STEP 1: Read in Mozambique EEZ and Shapefile**
```{r}
## read in MZ EEZ tif
mz_rast_id <- raster(here("set_up/final_rasters/mz_eez_templates/mz_rast_id.tif"))

## Grab Moz Exclusive Economic Zone (EEZ) shapefile from local computer
mz_eez_path <- 'G:/group_project/data/mz_eez'
mz_shape <- list.files(mz_eez_path, full.names = TRUE) 

mz_eez_sf <- sf::read_sf(mz_shape[6])

## check coordinate system
st_crs(mz_eez_sf)

## Add a buffer of 10 km to make sure cells on the outer edges of the EEZ are included
mz_eez_buffer_sf <- sf::st_buffer(mz_eez_sf, dist = 10000)
```


#### Cost Layer
Other scenarios will require more prep to create cost layer, so they will be found in separate Rmarkdowns. Since this scenario is so short, we created it in this Rmarkdown.
```{r}
### pull in the artisanal fishing pressure tif file from costs folder in repo
art_fish_rast <- raster(here("set_up", "final_rasters", "costs", "kernel_d_fishing_moz_v2.tif"))

## now we need to grab the Moz raster we previously created to make sure the artisanal fishing raster is in the right projections
art_fish <- raster::projectRaster(art_fish_rast, mz_rast_id, res = 10000, method = 'ngb')

## create a data frame to see what value ranges we are working with
art_fish_df <- as.data.frame(art_fish)

## plot to see what it looks like
plot(art_fish)
 
## Priortizr does not like cost values of NA or 0 so changed both to 0.1
art_fish[is.na(art_fish[])] <- 0
plot(art_fish)

## since we changed all NAs to 0.001 we need to again mask it to change values on land to NA
art_fish <- mask(art_fish, mz_eez_sf)
plot(art_fish)

# art_fish[art_fish == 0] <- 0.001
# plot(art_fish)

## now lets rescale from 0 to 1
#art_fish_rescaled <- log(art_fish+1)/ cellStats(log(art_fish+1), max)
art_fish_rescaled <- art_fish/maxValue(art_fish)
plot(art_fish_rescaled)

## Looks good lets save as a tif
writeRaster(art_fish_rescaled, here('set_up/final_rasters/costs/cost_art_fish.tif'), overwrite = TRUE)
```

