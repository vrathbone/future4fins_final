---
title: "Combined Fishing Pressure"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(raster)
library(tidyverse)
library(sf)
library(here)
library(fasterize)
library(stringr)
library(janitor)
```

#### **STEP 1: Read in Mozambique EEZ and Shapefile**
```{r}
## read in MZ EEZ tif
mz_rast_id <- raster(here("set_up/final_rasters/mz_eez_templates/mz_rast_id.tif"))

## Grab Moz Exclusive Economic Zone (EEZ) shapefile from local computer
mz_eez_path <- 'G:/group_project/data/mz_eez'
mz_shape <- list.files(mz_eez_path, full.names = TRUE) 

mz_eez_sf <- sf::read_sf(mz_shape[6])

## check coordinate system
st_crs(mz_eez_sf)

## Add a buffer of 10 km to make sure cells on the outer edges of the EEZ are included
mz_eez_buffer_sf <- sf::st_buffer(mz_eez_sf, dist = 10000)
```


#### **STEP 2: Read in Artisanal and Industrial Fishing Rasters**
```{r}
### read in artisanal fishing raster
art_fish_rast <- raster(here("set_up", "final_rasters", "costs", "cost_art_fish.tif"))

### read in industrial (rescaled and summed) raster
industrial_sum_rescaled <- raster(here("set_up", "final_rasters", "costs", "cost_industrial_sum.tif"))
```


#### **STEP 4: Create raster stack of all fishing**
```{r}
### create raster stack
combined_fishing_stack <- stack(industrial_sum_rescaled, art_fish_rast)

### plot it!
plot(combined_fishing_stack)

combined_stack_sum <- calc(combined_fishing_stack, fun = sum)
plot(combined_stack_sum)


writeRaster(combined_stack_sum, here('set_up/final_rasters/costs/combined_stack_sum.tif'), 
            options="INTERLEAVE=BAND",
            overwrite = TRUE)

### save it
writeRaster(combined_fishing_stack, here('set_up/final_rasters/costs/combined_fishing_stack.tif'), 
            options="INTERLEAVE=BAND",
            overwrite = TRUE)
```
```{r}
tmap_mode("view") # Set to interactive viewing

tm_shape(combined_stack_sum) +
  tm_basemap("Stamen.Terrain")+
  tm_raster("layer", alpha=0.9, palette = "viridis")
  
```






















