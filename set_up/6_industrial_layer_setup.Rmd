---
title: "Industrial input file"
author: "Vanessa Rathbone"
date: "1/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#load packages
library(raster)
library(tidyverse)
library(sf)
library(here)
library(fasterize)
library(stringr)
library(janitor)
library(fasterize)
```

#### **STEP 1: Read in Mozambique EEZ and Shapefile**
```{r}
## read in MZ EEZ tif
mz_rast_id <- raster(here("set_up/final_rasters/mz_eez_templates/mz_rast_id.tif"))

## Grab Moz Exclusive Economic Zone (EEZ) shapefile from local computer
mz_eez_path <- 'G:/group_project/data/mz_eez'
mz_shape <- list.files(mz_eez_path, full.names = TRUE) 

mz_eez_sf <- sf::read_sf(mz_shape[6])

## check coordinate system
st_crs(mz_eez_sf)

## Add a buffer of 10 km to make sure cells on the outer edges of the EEZ are included
mz_eez_buffer_sf <- sf::st_buffer(mz_eez_sf, dist = 10000)
```

```{r}
#read in tifs as rasters

long_line <- raster(here("set_up", "final_rasters", "costs", "industrial", "fishing_line_kernel_density_noports.tif"))

gamba <- raster(here("set_up", "final_rasters", "costs", "industrial", "Gamba_fishing_density_noports.tif"))

shrimp <- raster(here("set_up", "final_rasters", "costs", "industrial", "Shrimp_fishing_density_noports.tif"))

tuna <- raster(here("set_up", "final_rasters", "costs", "industrial", "Tuna_fishing_density_noports.tif"))

### reproject rasters to be in correct extent and crs

### long-line
long_line_rp <- projectRaster(long_line, mz_rast_id, res = 10000, method = 'ngb',
                crs = crs(mz_rast_id)) 

long_line_rp[is.na(long_line_rp[])] <- 0
plot(long_line_rp)

long_line_df <- long_line_rp %>% 
  as.data.frame()

long_line_rp <- mask(long_line_rp, mz_eez_sf)
plot(long_line_rp)

# long_line_rp[long_line_rp == 0] <- 0.001
# plot(long_line_rp)

#long_line_rescaled <- log(long_line_rp+1)/ cellStats(log(long_line_rp+1), max)

long_line_rescaled <- long_line_rp/maxValue(long_line_rp)

long_line_rescaled_df <- long_line_rescaled %>% 
  as.data.frame()

plot(long_line_rescaled)

```

```{r}
### gamba
gamba_rp <- projectRaster(gamba, mz_rast_id, res = 10000, method = 'ngb',
                crs = crs(mz_rast_id))

gamba_rp[is.na(gamba_rp[])] <- 0
plot(gamba_rp)

gamba_rp <- mask(gamba_rp, mz_eez_sf)
plot(gamba_rp)

# gamba_rp[gamba_rp == 0] <- 0.001
# plot(gamba_rp)

#gamba_rescaled <- log(gamba_rp+1)/ cellStats(log(gamba_rp+1), max)
gamba_rescaled <- gamba_rp/maxValue(gamba_rp)
plot(gamba_rescaled)


```

```{r}
### shrimp
shrimp_rp <- projectRaster(shrimp, mz_rast_id, res = 10000, method = 'ngb',
                crs = crs(mz_rast_id))

shrimp_rp[is.na(shrimp_rp[])] <- 0.001
plot(shrimp_rp)

shrimp_rp  <- mask(shrimp_rp, mz_eez_sf)
plot(shrimp_rp)

# shrimp_rp[shrimp_rp == 0] <- 0.001
# plot(shrimp_rp)

#shrimp_rescaled <- log(shrimp_rp+1)/ cellStats(log(shrimp_rp+1), max)
shrimp_rescaled <- shrimp_rp/maxValue(shrimp_rp)
plot(shrimp_rescaled)


```


```{r}
### tuna
tuna_rp <- projectRaster(tuna, mz_rast_id, res = 10000, method = 'ngb',
                crs = crs(mz_rast_id)) 

tuna_rp[is.na(tuna_rp[])] <- 0.001
plot(tuna_rp)

tuna_rp  <- mask(tuna_rp, mz_eez_sf)
plot(tuna_rp)

# tuna_rp[tuna_rp == 0] <- 0.001
# plot(tuna_rp)

#tuna_rescaled <- log(tuna_rp+1)/ cellStats(log(tuna_rp+1), max)
tuna_rescaled <- tuna_rp/maxValue(tuna_rp)
plot(tuna_rescaled)
```

```{r}

#create raster stack
industrial_stack <-  stack(long_line_rescaled, gamba_rescaled, shrimp_rescaled, tuna_rescaled)
plot(industrial_stack)

industrial_stack_df <- industrial_stack %>% 
  as.data.frame()

industrial_stack_sum <- sum(industrial_stack)
plot(industrial_stack_sum)

#industrial_stack_rescaled <- log(industrial_stack_sum+1)/ cellStats(log(industrial_stack_sum+1), max)
industrial_stack_sum_rescaled <- industrial_stack_sum/maxValue(industrial_stack_sum)

plot(industrial_stack_rescaled)

industrial_stack_rescaled_df <- industrial_stack_rescaled %>% as.data.frame()


writeRaster(industrial_stack, here('set_up/final_rasters/costs/cost_industrial_stack.tif'), overwrite = TRUE)
```

