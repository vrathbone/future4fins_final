---
title: "Scenario 2: Artisanal Fishing"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(raster)
library(tidyverse)
library(sf)
library(here)
library(fasterize)
library(stringr)
library(janitor)
library(prioritizr)
library(gurobi)

```

## Scenario 2 - Artisanal Fishing Pressure 
The objective of this scenario was to protect important areas for sharks and rays based on their distribution from IUCN and location of suitable habitats while minimizing the impact on artisanal fisherman.  For this run, we used area as the cost, set targets of 20% for all conservation features, locked in planning units that included existing MPAs, and set a boundary penalty to zero. 

### STEP 1: Assign planning units, cost layer, and conservation feature

#### Planning Unit

```

## Scenario 1 - Baseline
The objective of this scenario was to protect important areas for sharks and rays based on their distribution from IUCN and location of suitable habitats using a uniform cost for all planning units. For this run, we used area as the cost, set targets of 20% for all conservation features, locked in planning units that included existing MPAs, and set a boundary penalty to zero. 

### STEP 1: Assign planning units, cost layer, and conservation feature

#### Planning Unit
```{r}
### reading in the baseline MZ EEZ raster (with cell ids) 
pu_2 <- raster(here("set_up", "final_rasters", "mz_eez_templates", "mz_rast_id.tif"))

### plot to make sure it looks okay
plot(pu_2)

### looks good, but need a mask so must mask it
### to mask the raster:
## Grab Moz Exclusive Economic Zone (EEZ) shapefile from local computer
mz_eez_path_2 <- 'G:/group_project/data/mz_eez'
mz_shape_2 <- list.files(mz_eez_path, full.names = TRUE) 

## Read in shapefile as simple feature 
mz_eez_sf_2 <- sf::read_sf(mz_shape[6])

## check coordinate system
st_crs(mz_eez_sf_2)

## Add a buffer of 10 km to make sure cells on the outer edges of the EEZ are included
mz_eez_buffer_sf_2 <- sf::st_buffer(mz_eez_sf_2, dist = 10000)

pu_2 <- mask(pu_2, mz_eez_buffer_sf_2)

### now see what it looks like with a mask
plot(pu_2)

```



#### Cost Layer
Other scenarios will require more prep to create cost layer, so they will be found in separate Rmarkdowns. Since this scenario is so short, we created it in this Rmarkdown.
```{r}
### pull in the artisanal fishing pressure tif file from local computer and create a raster
art_fish_path <- 'G:/group_project/data/art_fish/kernel_d_fishing_moz_V2.tif'
art_fish_rast <- raster(art_fish_path)

## now we need to grab the Moz raster we previously created to make sure the artisanal fishing raster is in the right projections
mz_rast_id <- raster(here("set_up", "final_rasters", "mz_eez_templates", "mz_rast_id.tif"))

art_fish <- raster::projectRaster(art_fish_rast, mz_rast_id, res = 10000, method = 'ngb')

## create a data frame to see what value ranges we are working with
art_fish_df <- as.data.frame(art_fish)

## plot to see what it looks like
plot(art_fish)
 
## Priortizr does not like cost values of NA or 0 so changed both to 0.1
art_fish[is.na(art_fish[])] <- 0.1
plot(art_fish)

## Since we changed all NAs values to 0.1 we need to mask this to MZ eez since we are now picking up terrestrial areas 
cost_art_fish <- mask(art_fish, mz_rast_id)
plot(cost_art_fish)

## Looks good lets save as a tif
writeRaster(cost_art_fish, here('set_up/final_rasters/cost_art_fish.tif'), overwrite = TRUE)

```

